
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).BloggerJS=t()}(this,(function(){"use strict";class e{#e=new Map;#t=new Map;constructor(e={}){this.defaultConfig={homepage:window.location.origin+"/",maxResults:10,cacheTimeout:3e5,template:"",lazyLoad:!0,imageSizes:{small:"s80-c",medium:"s300",large:"s800"},defaultImageSize:"medium",snippetLength:100,labelOptions:{prefix:"label-",containerClass:"post-labels"},comments:{template:'<div class="comment"><img src="{authorImage}"/><a href="{authorUrl}">{authorName}</a><p>{content}</p></div>',maxResults:10},pagination:{prevText:"السابق",nextText:"التالي",firstPageVisible:!0,lastPageVisible:!0,numberClass:"page-number",nextPageClass:"next-page",prevPageClass:"prev-page",lastPageClass:"last-page",firstPageClass:"first-page",dotsPageClass:"page-dots"},video:{providers:{youtube:!0,vimeo:!0,dailymotion:!0},responsive:!0,thumbnailQuality:{youtube:{default:"default",medium:"mqdefault",high:"hqdefault",max:"maxresdefault"}}},emoji:{enable:!0,path:"https://cdn.jsdelivr.net/npm/emoji-datasource-twitter/img/twitter/64/",ext:".png"},sections:{template:'<div class="section">{content}</div>',containerClass:"blog-sections",itemClass:"section-item",titleClass:"section-title",contentClass:"section-content"},blog:{category:null,locale:"ar-EG",format:{month:"long",day:"2-digit",year:"numeric"},avatarImage:"https://www.gravatar.com/avatar/?d=mm",avatarSize:"s80",authorName:"Unknown",authorUrl:"",labels:{prefixClass:"label-",containerClass:"labels",before:"",after:"",filter:[],remove:[],without:"undefined_terms",terms:""}},related:{maxResults:6,scoreThreshold:.4,template:'<article class="related-post"><a href="{url}"><img loading="lazy" src="{image}" alt="{title}"/><h3>{title}</h3></a><p>{snippet}</p></article>',containerClass:"related-posts",titleClass:"related-title",showThumbnail:!0,showSnippet:!0,orderBy:"score",excludeLabels:[],requireLabels:[],minCommonTags:1}},this.config=this.#s(this.defaultConfig,e),"undefined"!=typeof document&&(this.#i(),this.parseUrlParameters()),this.contentProcessors=[this.processEmojis.bind(this),this.processVideos.bind(this),this.processLinks.bind(this),this.processImages.bind(this)]}#s(e,t){const s={...e};for(const i in t)t[i]instanceof Object&&!Array.isArray(t[i])?s[i]=this.#s(s[i]||{},t[i]):s[i]=t[i];return s}#i(e=""){return`${e}:${JSON.stringify(e)}`}#a(e,t,s=this.config.cacheTimeout){this.#e.set(e,{data:t,timestamp:Date.now()+s})}#n(e){const t=this.#e.get(e);return t?Date.now()>t.timestamp?(this.#e.delete(e),null):t.data:null}async#o(e,t,s={}){const i=this.#n(t);if(i)return i;if(this.#t.has(t))return this.#t.get(t);const a=fetch(e,s).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()})).finally((()=>{this.#t.delete(t)}));return this.#t.set(t,a),this.#a(t,await a),a}#i(){"IntersectionObserver"in window&&this.config.lazyLoad&&new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){const s=e.target;s.dataset.src&&(s.src=s.dataset.src,s.removeAttribute("data-src")),t.unobserve(s)}}))}),{rootMargin:"50px 0px",threshold:.01}).observe(document.querySelectorAll("img[data-src]")),document.addEventListener("click",(e=>{const t=e.target.closest("[data-bjs-action]");if(t){const s=t.dataset.bjsAction,i=this.parseDataset(t);this.handleAction(s,i,e)}}),{passive:!0})}async handleAction(e,t,s){switch(s?.preventDefault(),e){case"loadMore":await this.loadMorePosts(t);break;case"showComments":await this.loadComments(t.postId);break;case"search":await this.search(t.query);break;default:console.warn(`Unknown action: ${e}`)}}async processContent(e){return e?this.contentProcessors.reduce(((e,t)=>t(e)),e):""}processImages(e){if(!e)return"";const t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll("img").forEach((e=>{this.config.lazyLoad&&e.setAttribute("loading","lazy"),e.src.includes("blogger.com")&&(e.src=this.optimizeImageUrl(e.src,this.config.defaultImageSize))})),t.innerHTML}optimizeImageUrl(e,t){return e.replace(/s\d{2,4}(-c)?/,this.config.imageSizes[t]||t)}async fetchPosts(e={}){const t=new URLSearchParams({alt:"json","max-results":e.maxResults||this.config.maxResults,...e}),s=this.#i("posts",e),i=await this.#o(`${this.config.homepage}feeds/posts/default?${t}`,s);return this.processPosts(i.feed.entry||[])}processPosts(e){return e?.length?e.map((e=>{const[t]=e.author,s=e.content?.$t||e.summary?.$t||"";return{id:this.extractPostId(e.id.$t),title:e.title.$t,url:this.getPostUrl(e),content:this.processContent(s),snippet:this.createSnippet(s),images:this.extractImages(s),labels:this.extractLabels(e.category),author:{name:t.name.$t||this.config.blog.authorName,url:t.uri?.$t||this.config.blog.authorUrl,image:this.processAuthorImage(t.gd$image?.src),email:t.email?.$t},dates:{published:this.formatDate(e.published.$t),updated:this.formatDate(e.updated.$t),timestamp:new Date(e.published.$t).getTime()},stats:{comments:parseInt(e.thr$total?.$t||"0",10)}}})):[]}extractPostId(e){const t=e.match(/post-(\d+)/);return t?t[1]:null}createSnippet(e,t=this.config.snippetLength){if(!e)return"";const s=e.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();if(s.length<=t)return s;const i=s.substr(0,t),a=i.lastIndexOf(" ");return i.substr(0,a)+"..."}extractLabels(e){return e?.length?e.filter((e=>{const t=e.term;return!this.config.blog.labels.without.includes(t)&&!this.config.blog.labels.remove.includes(t)})).map((e=>({term:e.term,url:`${this.config.homepage}search/label/${encodeURIComponent(e.term)}`}))):[]}}return e}));
