!(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).BloggerJS=t()})(this,function(){"use strict";const e=/s\d{2}(-w\d{3}-h\d{3})?-c/;function t(e){for(const t of e)if("alternate"===t.rel)return t.href}function a(e){const t=null==e?0:e.length;if(!t)return[];let a=-1;const n=t-1,r=function(e,t){let a=-1;const n=e.length;for(t||(t=new Array(n));++a<n;)t[a]=e[a];return t}(e);for(;++a<t;){const e=a+Math.floor(Math.random()*(n-a+1)),t=r[e];r[e]=r[a],r[a]=t}return r}function n(e){return e.replace(/<[^>]*>?/g,"")}function r(e){if(!e)return!1;const t=e.querySelector("[data-bjs=template]");if(!t)return!1;t.removeAttribute("data-bjs");const a=t.outerHTML;return t.remove(),a.replace(/data-src/g,"src")}function l(e,t){return e.replace(/\{\{(.*?)\}\}/g,(e,a)=>t[a])}function s({dataset:e={}}){const t={};return Object.keys(e).forEach(a=>{var n;t[a]="true"===(n=e[a])||("false"!==n&&(Number(n).toString()===n?Number(n):"null"===n||""===n?null:n))}),t}function i(e){const t=document.createElement("script");t.src=e,document.body.appendChild(t).parentNode.removeChild(t)}const o={small:"s80-c",medium:"s300",large:"s500",max:"s800"},c={small:"default",medium:"mqdefault",large:"hqdefault",max:"maxresdefault"},u={homepage:window.location.origin+"/",category:null,locale:"ar",snippet:100,format:{month:"long",day:"2-digit",year:"numeric"},image:"",imageSize:"s300",avatarImage:"https://www.gravatar.com/avatar/?d=mm",avatarSize:"s80",authorName:"غير معروف",authorUrl:"",labels:{}};let S={firstPage:!1,perPage:7,length:5,label:null,prevText:"السابق",nextText:"التالي",lastPageText:null,ytThumbnail:"mqdefault",template:'<div><img src="{{img}}"/><a href="{{url}}">{{title}}</a></div>',empty:"<p>لم يتم العثور على مشاركات</p>",numberClass:"bjs-number",nextPageClass:"bjs-next-page",prevPageClass:"bjs-prev-page",firstPageClass:"bjs-first-page",lastPageClass:"bjs-last-page",dotsPageClass:"bjs-dots",firstPageVisible:!0,lastPageVisible:!0,infinite:!1,withButton:!1,buttonClass:"bjs-button-show-more",buttonText:"تحميل المزيد",buttonTextLoading:"جاري التحميل",rootMargin:"100px"};function j({homepage:e,label:t,perPage:a,page:n}){i(`${`${e}feeds/posts/default${t?`/-/${t}`:""}?alt=json-in-script&callback=BloggerJS.entry&max-results=${a}`}&start-index=${(n-1)*a+1}`)}const E=document.querySelector("[data-bjs=entry]"),L=document.querySelector("[data-bjs=pagination]");let _,k=1,H=!1;function B(e){E.innerHTML+=e}var q={sections:b,comments:y,related:function(e){if(!e.feed.entry)return;let t="",n=e.feed.entry.filter(e=>function(e){return e.id.$t.split(".post-")[1]}(e)!==v.id);v.random&&(n=a(n));const r=n.length<=v.length?n.length:v.length;Array.from({length:r}).forEach((e,a)=>{t+=l(v.template,p(n[a],v))}),C.innerHTML=t},entry:function(e){if(!e.feed.entry)return E.innerHTML="",B(S.empty),void(S.infinite&&L.remove());if(S.infinite){const{button:t,container:a}=_;H=!1,function({data:e,options:t,page:a,container:n}){t.firstPage||1!==a||(n.innerHTML=""),e.forEach(e=>{(t.firstPage&&1===a)||(n.innerHTML+=l(t.template,p(e,t)))})}({button:t,container:a,page:k,data:e.feed.entry,options:S}),S.withButton&&(t.textContent=S.buttonText);const n=Number(e.feed.openSearch$totalResults.$t),r=Math.ceil(n/(S.results??S.perPage));return void(k>=r&&L.remove())}const t=function({options:e,data:t,container:a}){let n="";return t.feed.entry.forEach(t=>{n+=l(e.template,p(t,e))}),N({...e,total:Number(t.feed.openSearch$totalResults.$t),container:a}),n}({options:S,data:e,container:L});E&&(E.innerHTML="",B(t))},initComments:function(e={}){Array.from(document.querySelectorAll("[data-bjs=comments]")).forEach((t,a)=>{const n={...x,...e,...s(t)},o=r(t);o&&(n.template=o),((e,t,a)=>{const n="comments"+a;y[n]=a=>{let n="";a.feed.entry?a.feed.entry.forEach(e=>{const a=p(e,t);n+=l(t.template,a)}):n+=t.empty,e.innerHTML=n},i(`${t.homepage}feeds/comments/default?alt=json-in-script&callback=BloggerJS.comments.${n}&max-results=${t.maxResults}`)})(t,n,a)})},initRelated:function(e={}){if(!C)return;v={...v,...e,...s(C)};const t=r(C);t&&(v.template=t);const a=("string"==typeof v.tags?JSON.parse(v.tags):v.tags).map(e=>`label:"${e}"`).join("|");i(`${v.homepage}feeds/posts/default?alt=json-in-script&callback=BloggerJS.related&max-results=${v.maxResults}&q=${a}`)},initEntry:function(e={}){S={...S,...f(),...e,...s(E||!1),...s(L||!1)};const t=r(E);t&&(S.template=t);const{firstPage:a,homepage:n,page:l,label:o,withButton:c,buttonClass:u,buttonText:m,rootMargin:g}=S,d=S.results??S.perPage,p=`${n}feeds/posts/default${o?`/-/${o}`:""}?alt=json-in-script&callback=BloggerJS.entry&max-results=${d}`;if(S.infinite){if(!E||!L)return;i(`${a?p.replace(/max-results=(.[0-9]*)/,"max-results=1"):p}&start-index=1`),_=function({container:e,pagination:t,withButton:a=!1,buttonClass:n,buttonText:r,onClick:l=()=>{},onVisible:s=()=>{},rootMargin:i="100px"}){let o=null;if(a)o=document.createElement("button"),o.className=n,o.textContent=r,o.addEventListener("click",()=>{l({button:o,container:e})}),t.innerHTML="",t.appendChild(o);else{const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&s()})},{rootMargin:i});e.observe(t)}return{container:e,button:o}}({buttonClass:u,buttonText:m,rootMargin:g,withButton:c,container:E,pagination:L,onClick({button:e}){H||(e.textContent=S.buttonTextLoading,H=!0,k++,j({label:o,perPage:d,homepage:n,page:k}))},onVisible(){k++,j({label:o,perPage:d,homepage:n,page:k})}})}else i(`${p}&start-index=${(l-1)*d+1}`)},initSection:function(e={}){Array.from(document.querySelectorAll("[data-bjs=section]")).forEach((t,a)=>{const n={...$,...e,...s(t)},l=r(t);if(l&&(n.template=l),!0===n.observer){const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&h(t,n,a)})},{rootMargin:n.rootMargin});e.observe(t)}else h(t,n,a)})}};return q});
