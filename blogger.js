((e,t)=>{"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).BloggerJS=t()})(this,(()=>{const e=/s\d{2}(-w\d{3}-h\d{3})?-c/;function t(e){for(const t of e)if("alternate"===t.rel)return t.href}function a(e){return e.replace(/<[^>]*>?/g,"")}function n(e){if(!e)return!1;const t=e.querySelector("[data-bjs=template]");if(!t)return!1;t.removeAttribute("data-bjs");const a=t.outerHTML;return t.remove(),a.replace(/data-src/g,"src")}function l(e,t){return e.replace(/\{\{(.*?)\}\}/g,((e,a)=>t[a]))}function r({dataset:e={}}){const t={};return Object.keys(e).forEach((a=>{var n;t[a]="true"===(n=e[a])||"false"!==n&&(Number(n).toString()===n?Number(n):"null"===n||""===n?null:n)})),t}function s(e){const t=document.createElement("script");t.src=e,document.body.appendChild(t).parentNode.removeChild(t)}const i={small:"s80-c",medium:"s300",large:"s500",max:"s800"},o={small:"default",medium:"mqdefault",large:"hqdefault",max:"maxresdefault"},c={homepage:window.location.origin+"/",category:null,locale:"ar-EG",snippet:100,format:{month:"long",day:"2-digit",year:"numeric"},image:"",imageSize:"s300",avatarImage:"https://www.gravatar.com/avatar/?d=mm",avatarSize:"s80",authorName:"غير معروف",authorUrl:"",labels:{}};function m(e){return null!=e&&"string"==typeof e&&e.includes("img.youtube.com")}function u(t,a){return m(t)?t.replace("default",o[a]||a):t.replace(e,i[a]||a)}function g(e,t){return null!=e&&e.length?(e=e?.map((e=>`<a class='${t.prefixClass+e.term}' href='${t.origin}search/label/${e.term}'>${t.before+e.term+t.after}</a>`))?.join(""),`<div class='${t.containerClass}'>${e}</div>`):[]}function d(e,n){const[l]=e.author,r=e.content?e.content.$t:e.summary.$t,s={...c,...n},i=e.id.$t.split(".post-"),o=i[1],d=i[0].split(":blog-")[1],p=e.media$thumbnail?e.media$thumbnail.url:(e=>{const t=document.createElement("div");t.innerHTML=e;const a=t.querySelector("img");return a?a.src:""})(r)||s.image,f=l.gd$image.src.includes("g/blank.gif")||l.gd$image.src.includes("g/b16-rounded.gif")?s.avatarImage:l.gd$image.src,b=s.homepage,h=s.labels.length||10,$=(null!==e.category&&e.category)?.filter((e=>!e.term.includes(s.labels.without||"undefined_terms")))?.filter((e=>!(s.labels.remove||[]).includes(e.term))).slice(0,h),x=e.category?.filter((e=>e.term.includes(s.labels.terms||""))).slice(0,h),y=e.category?.filter((e=>(s.labels.filter||[]).includes(e.term))).slice(0,h),v={origin:b,prefixClass:s.labels.prefixClass||"label-",containerClass:s.labels.containerClass||"labels",before:s.labels.before||"",after:s.labels.after||""};let C,P,T,w;return{blog_id:d,post_id:o,author_name:"Unknown"!==l.name.$t?l.name.$t:s.authorName,author_url:l.uri?l.uri.$t:s.authorUrl,author_image:f.replace(/s\B\d{2,4}/,s.avatarSize),author_email:l.email?l.email.$t:"#noEmail",img:u(p,m(p)?s.ytThumbnail:s.imageSize),img_max:u(p,"max"),img_large:u(p,"large"),img_medium:u(p,"medium"),img_small:u(p,"small"),time:(C=e.published.$t,P={locale:s.locale,format:s.format},new Date(C).toLocaleDateString(P.locale,P.format)),snippet:(T=a(r),w=s.snippet,T.length>w?`${T.substring(0,w)}...`:T),labels:null==$?[]:$?.map((e=>e.term)),labels_links:g($,v),labels_filter:g(y,v),labels_terms:g(x,v),content:a(r),url:t(e.link),published:new Date(e.published.$t).getTime(),title:e.title.$t,update:new Date(e.updated.$t).getTime(),category:s.category,thr:e.thr$total?e.thr$total.$t:"0"}}function p(){const e=new URLSearchParams(window.location.search);let t=e.get("page");var a;return(null===t||(a=t,Number(a).toString()!==a)||Number(t)<1)&&(t="1"),{page:Number(t),results:e.get("max-results"),label:e.get("label"),view:e.get("view")}}const f={},b={maxResults:6,template:'<div class="bjs-comments">\n  <img src="{{author_image}}"/>\n  <a href="{{url}}">{{author_name}}</a>\n  <p>{{snippet}}</p>\n</div>',empty:"<p>Sin comentarios</p>"};let h={id:"",length:7,maxResults:8,tags:[],random:!0,template:'<div class="bjs-article">\n  <img src="{{img}}"/>\n  <a href="{{url}}">{{title}}</a>\n</div>'};const $=document.querySelector("[data-bjs=related]");function x({number:e,label:t,perPage:a}){let n=`/search?page=${e}`;const l={...p()};return t&&(n+=`&label=${t}`),l.view&&(n+=`&view=${l.view}`),n+=`&max-results=${l.results??a}`,n}function y({active:e,url:t,title:a,className:n=""}){const l=document.createElement("li"),r=document.createElement("a");return r.href=t,r.innerHTML=a,r.className=n,e&&l.classList.add("is-active"),l.appendChild(r),l}function v({className:e}){const t=document.createElement("li"),a=document.createElement("span");return a.textContent="...",a.className=e,t.appendChild(a),t}function C({homepage:e,firstPage:t,perPage:a,label:n,active:l,className:r}){return y({url:t?e:x({number:"1",label:n,perPage:a}),title:"1",active:l,className:r})}let P={firstPage:!1,perPage:7,length:5,label:null,prevText:"السابق",nextText:"التالي",lastPageText:null,ytThumbnail:"mqdefault",template:'<div><img src="{{img}}"/><a href="{{url}}">{{title}}</a></div>',empty:"<p>No se ha encontrado entradas</p>",numberClass:"bjs-number",nextPageClass:"bjs-next-page",prevPageClass:"bjs-prev-page",firstPageClass:"bjs-first-page",lastPageClass:"bjs-last-page",dotsPageClass:"bjs-dots",firstPageVisible:!0,lastPageVisible:!0,infinite:!1,withButton:!1,buttonClass:"bjs-button-show-more",buttonText:"تحميل المزيد",buttonTextLoading:"جاري التحميل...",rootMargin:"100px"};function T({homepage:e,label:t,perPage:a,page:n}){s(`${e}feeds/posts/default${t?`/-/${t}`:""}?alt=json-in-script&callback=BloggerJS.entry&max-results=${a}&start-index=${(n-1)*a+1}`)}const w=document.querySelector("[data-bjs=entry]"),N=document.querySelector("[data-bjs=pagination]");let M,j=1,S=!1;function E(e){w.innerHTML+=e}var L={sections:{},comments:f,related:e=>{if(!e.feed.entry)return;let t="",a=e.feed.entry.filter((e=>(e=>e.id.$t.split(".post-")[1])(e)!==h.id));h.random&&(a=(e=>{const t=null==e?0:e.length;if(!t)return[];let a=-1;const n=t-1,l=((e,t)=>{let a=-1;const n=e.length;for(t||(t=new Array(n));++a<n;)t[a]=e[a];return t})(e);for(;++a<t;){const e=a+Math.floor(Math.random()*(n-a+1)),t=l[e];l[e]=l[a],l[a]=t}return l})(a));const n=a.length<=h.length?a.length:h.length;Array.from({length:n}).forEach(((e,n)=>{t+=l(h.template,d(a[n],h))})),$.innerHTML=t},entry:e=>{if(!e.feed.entry)return w.innerHTML="",E(P.empty),void(P.infinite&&N.remove());if(P.infinite){const{button:t,container:a}=M;S=!1,(({data:e,options:t,page:a,container:n})=>{t.firstPage||1!==a||(n.innerHTML=""),e.forEach((e=>{t.firstPage&&1===a||(n.innerHTML+=l(t.template,d(e,t)))}))})({button:t,container:a,page:j,data:e.feed.entry,options:P}),P.withButton&&(t.textContent=P.buttonText);const n=Number(e.feed.openSearch$totalResults.$t),r=Math.ceil(n/(P.results??P.perPage));return void(j>=r&&N.remove())}const t=(({options:e,data:t,container:a})=>{let n="";return t.feed.entry.forEach((t=>{n+=l(e.template,d(t,e))})),(({container:e,page:t,results:a,perPage:n,length:l,total:r,label:s,prevText:i,nextText:o,lastPageText:c,firstPage:m,homepage:u,numberClass:g,nextPageClass:d,prevPageClass:p,lastPageClass:f,firstPageClass:b,dotsPageClass:h,firstPageVisible:$,lastPageVisible:P})=>{const T=document.createDocumentFragment(),w=Math.ceil(r/(a??n)),N=((e,t,a)=>{const n=[];e>a&&(e=a);let l=1,r=a||1;a>=t&&(r=Math.min(Math.max(e+Math.ceil(t/2)-1,t),a),l=r-t+1);for(let e=l;e<=r;e++)n.push(e);return n})(t,l,w);if(t-1>0){const e=y({url:m&&t-1==1?u:x({number:t-1,label:s,perPage:n}),title:i,className:p});T.appendChild(e)}if($&&!N.includes(1)){const e=C({firstPage:m,homepage:u,label:s,className:b,perPage:n}),t=v({className:h});T.appendChild(e),T.appendChild(t)}if(N.forEach((e=>{let a=null;a=1===e?C({firstPage:m,homepage:u,label:s,active:e===t,className:g,perPage:n}):y({url:x({number:e,label:s,perPage:n}),title:e,active:e===t,className:g}),T.appendChild(a)})),P&&!N.includes(w)){const e=y({url:x({number:w,label:s,perPage:n}),title:c||w,className:f}),t=v({className:h});T.appendChild(t),T.appendChild(e)}if(t+1<=w){const e=y({url:x({number:t+1,label:s,perPage:n}),title:o,className:d});T.appendChild(e)}e.innerHTML="",e.appendChild(T)})({...e,total:Number(t.feed.openSearch$totalResults.$t),container:a}),n})({options:P,data:e,container:N});w&&(w.innerHTML="",E(t))},initComments:(e={})=>{Array.from(document.querySelectorAll("[data-bjs=comments]")).forEach(((t,a)=>{const i={...b,...e,...r(t)},o=n(t);o&&(i.template=o),((e,t,a)=>{const n="comments"+a;f[n]=a=>{let n="";a.feed.entry?a.feed.entry.forEach((e=>{const a=d(e,t);n+=l(t.template,a)})):n+=t.empty,e.innerHTML=n},s(`${t.homepage}feeds/comments/default?alt=json-in-script&callback=BloggerJS.comments.${n}&max-results=${t.maxResults}`)})(t,i,a)}))},initRelated:(e={})=>{if(!$)return;h={...h,...e,...r($)};const t=n($);t&&(h.template=t);const a=("string"==typeof h.tags?JSON.parse(h.tags):h.tags).map((e=>`label:"${e}"`)).join("|");s(`${h.homepage}feeds/posts/default?alt=json-in-script&callback=BloggerJS.related&max-results=${h.maxResults}&q=${a}`)},initEntry:(e={})=>{P={...P,...p(),...e,...r(w||!1),...r(N||!1)};const t=n(w);t&&(P.template=t);const{firstPage:a,homepage:l,page:i,label:o,withButton:c,buttonClass:m,buttonText:u,rootMargin:g}=P,d=P.results??P.perPage,f=`${l}feeds/posts/default${o?`/-/${o}`:""}?alt=json-in-script&callback=BloggerJS.entry&max-results=${d}`;if(P.infinite){if(!w||!N)return;s(`${a?f.replace(/max-results=(.[0-9]*)/,"max-results=1"):f}&start-index=1`),M=(({container:e,pagination:t,withButton:a=!1,buttonClass:n,buttonText:l,onClick:r=(()=>{}),onVisible:s=(()=>{}),rootMargin:i="100px"})=>{let o=null;return a?(o=document.createElement("button"),o.className=n,o.textContent=l,o.addEventListener("click",(()=>{r({button:o,container:e})})),t.innerHTML="",t.appendChild(o)):new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&s()}))}),{rootMargin:i}).observe(t),{container:e,button:o}})({buttonClass:m,buttonText:u,rootMargin:g,withButton:c,container:w,pagination:N,onClick({button:e}){S||(e.textContent=P.buttonTextLoading,S=!0,j++,T({label:o,perPage:d,homepage:l,page:j}))},onVisible(){j++,T({label:o,perPage:d,homepage:l,page:j})}})}else s(`${f}&start-index=${(i-1)*d+1}`)}};return L}));
